## Введение в основы Node и Express

Node.js - это среда выполнения JavaScript, которая позволяет разработчикам писать бэкэнд (серверные) программы на JavaScript. Node.js поставляется с несколькими встроенными модулями - небольшими независимыми программами, которые помогают облегчить эту задачу. Некоторые из основных модулей включают в себя:

+ HTTP: модуль, который действует как сервер
+ File System: модуль, который читает и изменяет файлы
+ Path: модуль для работы с каталогами и путями к файлам
+ Assertion Testing: модуль, который проверяет код на соответствие предписанным ограничениям

Express является еще одним модулем, который часто используется с Node.js, но не входит в него. Express выполняется между созданным Node.js сервером и фронтендом веб-приложения. Express также обрабатывает маршрутизацию приложения. Маршрутизация направляет пользователей на нужную страницу в зависимости от их взаимодействия с приложением. Хотя существуют альтернативы использованию Express, его простота делает его хорошим местом для начала при изучении взаимодействия между бэкэндом, работающим на Node.js и фронтендом.

Работа над этими заданиями будет включать в себя написание кода на Glitch в нашем стартовом проекте. После завершения каждого задания вы можете скопировать свой публичный URL-адрес Glitch (на домашнюю страницу вашего приложения) в экран задания, чтобы проверить его! При желании вы можете написать свой проект на другой платформе, но он должен быть публично виден для нашего тестирования.

Запустите этот проект на Glitch с помощью шаблона [Backend Challenges Boilerplate](https://glitch.com/edit/#!/remix/clone-from-repo?REPO_URL=https://github.com/freeCodeCamp/boilerplate-express/) (необходимо, если вы используете Glitch) или клонируйте [этот репозиторий](https://github.com/freeCodeCamp/boilerplate-express/) на GitHub! Если вы используете Glitch, не забудьте сохранить ссылку на ваш проект в безопасном месте!

## Знакомство с консолью Node

В процессе разработки важно иметь возможность проверить, что происходит в вашем коде. Node - это просто среда выполнения JavaScript. Как и на клиентском JavaScript, вы можете использовать консоль для отображения полезной отладочной информации. На локальном компьютере вы увидите консоль вывода в терминале. На Glitch вы можете открыть логи в нижней части экрана. Вы можете переключить панель журнала с помощью кнопки ‘Logs’ (внизу слева, в меню "Tools").

Мы рекомендуем держать панель журнала открытой во время работы над этими заданиями. Читая журналы, вы можете быть осведомлены о характере ошибок, которые могут возникнуть.

Если вы еще не сделали этого, пожалуйста, прочитайте инструкцию [во введении](https://www.freecodecamp.org/learn/apis-and-microservices/basic-node-and-express/) и начните новый проект на Glitch, используя [эту ссылку](https://glitch.com/edit/#!/remix/clone-from-repo?REPO_URL=https://github.com/freeCodeCamp/boilerplate-express/).

Измените файл `myApp.js` для вывода "Hello World" в консоль.

## Установка фреймворка Express

Для дальнейших действий у вас уже должен быть установлен Node.js. В терминале создайте каталог `myapp` и сделайте его рабочим.

```
$ mkdir myapp
$ cd myapp
```

С помощью команды `npm init` создайте файл `package.json`. 

```
$ npm init
```

Эта команда выдает целый ряд приглашений, например, приглашение указать имя и версию вашего приложения. На данный момент, достаточно просто нажать клавишу ВВОД, чтобы принять предлагаемые значения по умолчанию для большинства пунктов, кроме следующего:

```
entry point: (index.js)
```

Введите app.js или любое другое имя главного файла по своему желанию. Если вас устраивает index.js, нажмите клавишу ВВОД, чтобы принять предложенное имя файла по умолчанию.

Теперь установите Express в каталоге `myapp`:

```
$ npm install express
```
После установки в каталоге `myapp` будут находится два файла `package.json`, `package-lock.json` и каталог `node_modules`.

## Начало работы фреймворка Express

В каталоге `myapp` создайте файл с именем `index.js` и скопируйте в него следующий код:

```js
// подключение express
const express = require("express");
// создание объекта app
const app = express();
// для маршрута "/" определяется обработчик 
app.get("/", function(req, res){     
    // отправление ответа
    res.send("<h1>Главная страница</h1>");
});
// метод listen сообщает вашему серверу, прослушивать порт 3000
app.listen(3000);
```

Вы создали простейшее приложение Express. Теперь запустите приложение из терминала. Для этого в рабочем каталоге `myapp` введите следующую команду:

```
$ node index.js
```

После этого откройте в браузере страницу http://localhost:3000/ и вы увидите заголовок первого уровня "Главная страница".

![Главная страница](images/home-page.png)

Приложение выдает ответ “Главная страница” на запросы, адресованные корневому URL (/) или ***маршруту***. Для всех остальных путей ответом будет **404 Not Found**.

Функция `app.get(МАРШРУТ, ОБРАБОТЧИК)` сравнивает поступивший GET-запрос с `МАРШРУТ'ом` и если они совпадают срабатывает `ОБРАБОТЧИК`. В методе `app.get` первый параметр - это относительный путь (маршрут) на сервере, который может быть не только строкой, но и регулярным выражением.

`req` (запрос) и `res` (ответ) являются теми же объектами, которые предоставляет Node, поэтому можно вызвать `req.pipe()`, `req.on('data', callback)` и выполнить любые другие действия, не требующие участия Express.

Добавьте еще один маршрут и соответствующий ему обработчик. Для этого в файле `index.js` измените код на следующий:

```js
const express = require("express");
const app = express();

app.get("/", function(req, res){       
    res.send("<h1>Главная страница</h1>");
});
app.get("/contact", function(req, res){     
    res.send("<h1>Контакты</h1>");
});

app.listen(3000);
```

Теперь сервер сможет обрабатывать два маршрута в приложении: http://localhost:3000/ и http://localhost:3000/contact. Таким образом, можно добавить любое количество маршрутов с соответствующими обработчиками.

Если в браузере перейти по адресу http://localhost:3000/contact, то вы увидите страницу с заголовком первого уровня "Контакты"

## Отправка HTML-файла

В предыдущем параграфе на клиентские (браузерные) GET-запросы серверные обработчики выдавали тот или иной HTML текст. В качестве ответа на запрос может быть выдан не только HTML текст, но и файлы, например, изображения, файлы CSS и JavaScript. Для этого в обработчик маршрута `app.get('/', ...)` нужно поместить метод `res.sendFile(path)`. 

Создайте каталог `views`, а в нем файл `index.html`, в который скопируйте следующий код:

```html
<!DOCTYPE html>
<html>
<head>
    <title>О сайте</title>
    <meta charset="utf-8" />
</head>
<body>
    <h1>О сайте</h1>
</body>
<html>
```
Затем измените файл `index.js`:

```js
const express = require("express");
const app = express();

app.get("/", function (req, res) {
    res.sendFile(__dirname + "/views/index.html");
});

app.listen(3000);
```
Даный код отправяет файл `/views/index.html` в качестве ответа на GET запрос. Запросом здесь является корневой маршрут `/`.

Данный метод сообщает браузеру тип файла и в зависимости от типа файла браузер будет знать, как обрабатывать файл. Затем метод прочитает и отправит файл. Путь к файлу `path` в этом методе должен быть абсолютным. Для вычисления абсолютного пути рекомендуется использовать глобальную переменную Node `__dirname`:

```js
absolutePath = __dirname + 'relativePath/file.ext'
```
`__dirname` возвращает полный путь к текущему каталогу.

## Выдача статических ресурсов

HTML сервер обычно имеет один или несколько каталогов, доступных пользователю. В этих каталогах обычно размещаются статические ресурсы, такие как, файлы CSS, JavaScript, изображения. В ответ на запросы пользователя сервер должен уметь предоставлять эти ресурсы. В Express эта функциональность реализуется с помощью функции промежуточной обработки (middleware) `express.static(path)`, где параметр `path` является **абсолютным** путем к папке, содержащей ресурсы. middleware должно быть установлено с помощью `app.use(path, middlewareFunction)`. Первый аргумент `path` является необязательным. Если вы не передадите его, `middlewareFunction` будет выполнено для всех запросов.



Примонтируйте middleware `express.static()` для всех запросов с `app.use()`. Абсолютный путь к папке ресурсов - `__dirname + "/public"`.

Теперь ваше приложение должно иметь возможность обслуживать таблицу стилей CSS. Снаружи общая папка будет отображаться подключенной к корневому каталогу. Ваша первая страница должна выглядеть немного лучше сейчас!

## Выдача JSON на определенном маршруте

В то время как сервер HTML обслуживает HTML, API обслуживает данные. API REST (REpresentational State Transfer) позволяет обмениваться данными простым способом, без необходимости для клиентов знать какие-либо детали о сервере. Клиенту нужно только знать, где находится ресурс (URL-адрес), и действие, которое он хочет выполнить с этим ресурсом (команда-глагол). Так, команда GET используется, когда вы хотите получить некоторую информацию, ничего при этом не изменяя. В наши дни предпочтительным форматом данных для перемещения информации по сети является JSON. Проще говоря, JSON - это удобный способ представления объекта JavaScript в виде строки, поэтому он может быть легко передан.

Давайте создадим простой API, создав маршрут, который отвечает с помощью JSON на путь `/json`. Вы можете сделать это с помощью метода `app.get()`. Внутри обработчика маршрута используйте метод `res.json()`, передавая объект в качестве аргумента. Этот метод закрывает цикл запрос-ответ, возвращая данные. За кулисами он преобразует допустимый объект JavaScript в строку, затем устанавливает соответствующие заголовки, чтобы сообщить вашему браузеру, что вы обслуживаете JSON, и отправляет данные обратно. Допустимый объект имеет обычную структуру `{key: data}`. `data` может быть числом, строкой, вложенным объектом или массивом. `data` также могут быть переменной или результатом вызова функции, в этом случае они будут вычислены перед преобразованием в строку.

Используйте объект `{"message":" Hello json"}` в качестве ответа в формате JSON для получения запросов к маршруту `/json`. Затем наведите браузер на `your-app-url/json`, вы должны увидеть сообщение на экране.



Используемые ресурсы:

* https://expressjs.com/ru
* https://metanit.com/web/nodejs
* https://developer.mozilla.org/ru/docs/Learn/Server-side/Express_Nodejs
* https://www.freecodecamp.org/learn/apis-and-microservices/basic-node-and-express
